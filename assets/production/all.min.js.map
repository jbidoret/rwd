{"version":3,"sources":["notes.js","main.js"],"names":["processFootNotesToSideNotes","opts","selector","rootSel","footNoteAnchorIdStart","footNotesAnchors","document","querySelectorAll","sidenotes","i","Array","prototype","forEach","call","ref","anchor","querySelector","id","getAttribute","replace","target","getElementById","back","parentElement","removeChild","node","createElement","classList","add","setAttribute","innerHTML","label","className","textContent","input","type","image","alt","caption","after","sidenote","num","push","footNotesConts","footNotesContainerSel","footNoteCont","parentNode","initializeFootnotes","options","notes","footNoteIdPattern","sideNoteClass","note","container","insertBefore","wip","setRandomPosition","e","left","Math","round","random","window","innerWidth","getBoundingClientRect","width","tp","innerHeight","height","style","top","body","onclick","w","event","contains","cloneNode","remove","appendChild","headings","heading","btn","nextElementSibling","location","hash","hidden","expanded","article","link","preventDefault","fig","dataset","figure","classname","onload","parent","src","video","source","figcaption","matches","close"],"mappings":"AACA,IAAAA,4BAAA,SAAAC,gBAEA,IAAAC,EAAAD,EAAAE,QAAA,SAAAF,EAAAG,sBAAA,IACAC,EAAAC,SAAAC,iBAAAL,GACAM,EAAA,GACAC,EAAA,EAGAC,MAAAC,UAAAC,QAAAC,KAAAR,EAAA,SAAAS,GAGA,IAAAC,EAAAD,EAAAE,cAAA,KACAC,EAAAF,EAAAG,aAAA,QAAAC,QAAA,IAAA,IACAC,EAAAd,SAAAe,eAAAJ,GACAK,EAAAF,EAAAJ,cAAA,qBACAM,EAAAC,cAAAC,YAAAF,GAGA,IAAAG,EAAAnB,SAAAoB,cAAA,SACAD,EAAAE,UAAAC,IAAA,WACAH,EAAAI,aAAA,WAAApB,GACAgB,EAAAK,UAAAV,EAAAU,UAGA,IAAAC,EAAAzB,SAAAoB,cAAA,SACAK,EAAAC,UAAA,kBACAD,EAAAF,aAAA,MAAA,WAAAZ,GACAc,EAAAE,YAAAlB,EAAAkB,YACAC,EAAA5B,SAAAoB,cAAA,SACAQ,EAAAC,KAAA,WACAD,EAAAjB,GAAA,WAAAA,EACAiB,EAAAF,UAAA,YAGAI,EAAAX,EAAAT,cAAA,QACAoB,IACAC,EAAAD,EAAAlB,aAAA,WAEAoB,EAAAhC,SAAAoB,cAAA,SACAM,UAAA,UACAM,EAAAL,YAAAI,EACAD,EAAAG,MAAAD,IAKA,IAAAE,EAAA,GACAA,EAAAvB,GAAAA,EACAuB,EAAA1B,IAAAA,EACA0B,EAAAT,MAAAA,EACAS,EAAAN,MAAAA,EACAM,EAAAf,KAAAA,EACAe,EAAAC,IAAAhC,EACAD,EAAAkC,KAAAF,GACA/B,MAKAkC,EAAArC,SAAAC,iBAAAN,EAAAE,QAAA,IAAAF,EAAA2C,uBAMA,OAJAlC,MAAAC,UAAAC,QAAAC,KAAA8B,EAAA,SAAAE,GACAA,EAAAC,WAAAtB,YAAAqB,KAGArC,GAIAuC,oBAAA,SAAAC,gBAEA,IAuBAC,EAAAjD,4BAvBAgD,GAAA,CACA7C,QAAA,QACAyC,sBAAA,aACAM,kBAAA,MACA9C,sBAAA,QACA+C,cAAA,YAoBAF,EAdArC,QAAA,SAAAwC,GAEA,IAAAC,EAAAD,EAAAtC,IAAAS,cAEA8B,EAAAC,aAAAF,EAAArB,MAAAqB,EAAAtC,KACAuC,EAAAC,aAAAF,EAAAlB,MAAAkB,EAAAtC,KACAuC,EAAAC,aAAAF,EAAA3B,KAAA2B,EAAAtC,KAEAuC,EAAA7B,YAAA4B,EAAAtC,QCvFA,MAAAyC,IAAAjD,SAAAU,cAAA,UAIA,SAAAwC,kBAAAC,GACA,IAAAC,EAAAC,KAAAC,MAAAD,KAAAE,UAAAC,OAAAC,WAAAN,EAAAO,wBAAAC,QACAC,EAAAP,KAAAC,MAAAD,KAAAE,UAAAC,OAAAK,YAAAV,EAAAO,wBAAAI,SACAX,EAAAY,MAAAX,KAAAA,EAAA,KACAD,EAAAY,MAAAC,IAAAJ,EAAA,KAPAX,KAAAC,kBAAAD,KAWAjD,SAAAiE,KAAAC,QAAA,IACA,IACAC,EADAC,EAAAtD,OAAAO,UAAAgD,SAAA,YACAF,EAAAC,EAAAtD,OAAAwD,WAAA,IACAjD,UAAAkD,OAAA,QACAvE,SAAAiE,KAAAO,YAAAL,GACAjB,kBAAAiB,GACAC,EAAAtD,OAAAO,UAAAC,IAAA,UAMA,MAAAmD,SAAAzE,SAAAC,iBAAA,aAEAG,MAAAC,UAAAC,QAAAC,KAAAkE,SAAAC,IACA,IAAAC,EAAAD,EAAAhE,cAAA,UACAI,EAAA4D,EAAAE,mBAEA,eAAA5E,SAAA6E,SAAAC,OACAH,EAAApD,aAAA,iBAAA,GACAT,EAAAiE,QAAA,GAGAJ,EAAAT,QAAA,KACA,IAAAc,EAAA,SAAAL,EAAA/D,aAAA,mBAAA,EACA+D,EAAApD,aAAA,iBAAAyD,GACAlE,EAAAiE,OAAAC,KASA,MAAAC,QAAAjF,SAAAU,cAAA,SAGAuE,UAGAxC,sBAEAwC,QAAAf,QAAA,IAEA,MAAAgB,EAAAd,EAAAtD,OACA,GAAAoE,EAAA7D,UAAAgD,SAAA,cAAA,CAGA,GAFAD,EAAAe,iBAEAD,EAAA7D,UAAAgD,SAAA,UAAA,CACAe,EAAApF,SAAAU,cAAA,WAAAwE,EAAAG,QAAA1E,IAGA,OAFAyE,EAAAnE,cAAAC,YAAAkE,QACAF,EAAA7D,UAAAkD,OAAA,UAKA,MAAAe,EAAAtF,SAAAoB,cAAA,UAIA,GAHAkE,EAAA5D,UAAA,kBACA4D,EAAA3E,GAAA,UAAAuE,EAAAG,QAAA1E,GAEA,SAAAuE,EAAAG,QAAAxD,KAAA,CACA,MAAAC,EAAA9B,SAAAoB,cAAA,OACAU,EAAAyD,UAAA,QACAD,EAAAd,YAAA1C,GAEAA,EAAA0D,OAAA,KACA,IAAAC,EAAAP,EAAA1C,WACAiD,EAAAjD,WAAAQ,aAAAsC,EAAAG,EAAAb,oBACAM,EAAA7D,UAAAC,IAAA,WAGA,IAAAoE,EAAAR,EAAAtE,aAAA,QACAkB,EAAA4D,IAAAA,GAEA3D,EAAAmD,EAAAG,QAAAtD,MAEAD,EAAAP,aAAA,MAAAQ,GAIA,GAAA,SAAAmD,EAAAG,QAAAxD,KAAA,CACA,MAAA8D,EAAA3F,SAAAoB,cAAA,SACAuE,EAAAJ,UAAA,QACAD,EAAAd,YAAAmB,GAEA,IAAAD,EAAAR,EAAAtE,aAAA,QACA+E,EAAAD,IAAAA,EACAC,EAAApE,aAAA,WAAA,QACAkE,EAAAP,EAAA1C,WACAiD,EAAAjD,WAAAQ,aAAAsC,EAAAG,EAAAb,oBACAM,EAAA7D,UAAAC,IAAA,WAEAS,EAAAmD,EAAAG,QAAAtD,MAEA4D,EAAApE,aAAA,MAAAQ,GAKAC,EAAAkD,EAAAN,mBACAgB,EAAAV,EAAAG,QAAAO,OACA,GAAA5D,GAAA4D,EAAA,CACA,MAAAC,EAAA7F,SAAAoB,cAAA,cACAY,EAAA8D,QAAA,oBACAD,EAAArE,UAAA,MAAAQ,EAAAR,UAAA,OACA8D,EAAAd,YAAAqB,IAEAD,IACAC,EAAArE,UAAAqE,EAAArE,UAAA,YAAAoE,EAAA,gBAKAG,EAAA/F,SAAAoB,cAAA,UACA2E,EAAApE,YAAA,IACAoE,EAAArE,UAAA,QACA4D,EAAAd,YAAAuB,GACAA,EAAA7B,QAAA,KACAoB,EAAA9C,WAAAtB,YAAAoE,GACAJ,EAAA7D,UAAAkD,OAAA","file":"all.min.js","sourcesContent":["\nvar processFootNotesToSideNotes = function processFootNotesToSideNotes(opts) {\n  'use strict';\n  var selector = opts.rootSel + ' [id^=' + opts.footNoteAnchorIdStart + ']';\n  var footNotesAnchors = document.querySelectorAll(selector),\n    sidenotes = [],\n    i = 1; //Note numbering\n\n  //Each footnote\n  Array.prototype.forEach.call(footNotesAnchors, function (ref) {\n\n\n    var anchor = ref.querySelector(\"a\");\n    var id = anchor.getAttribute('href').replace('#', '');\n    var target = document.getElementById(id);\n    var back = target.querySelector('a[href^=\"#fnref\"]');\n    back.parentElement.removeChild(back);\n\n    // build note node\n    var node = document.createElement('aside');\n    node.classList.add('sn-note');\n    node.setAttribute('data-ref', i);\n    node.innerHTML = target.innerHTML;\n\n    // build label + input\n    var label = document.createElement('label');\n    label.className = \"sn-toggle-label\";\n    label.setAttribute(\"for\", \"sn-note-\" + id);\n    label.textContent = anchor.textContent;\n    var input = document.createElement('input');\n    input.type = \"checkbox\";\n    input.id = \"sn-note-\" + id;\n    input.className = \"sn-toggle\";\n\n    // if image\n    var image = node.querySelector('img');\n    if(image){\n      var alt = image.getAttribute('alt');\n      if(alt) {\n        var caption = document.createElement('span');\n        caption.className = \"caption\";\n        caption.textContent = alt;\n        image.after(caption)\n      }\n    }\n\n    // build object\n    var sidenote = {};\n    sidenote.id = id;\n    sidenote.ref = ref;\n    sidenote.label = label;\n    sidenote.input = input;\n    sidenote.node = node;\n    sidenote.num = i;\n    sidenotes.push(sidenote);\n    i++;\n\n  });\n\n  //remove the footNotes container\n  var footNotesConts = document.querySelectorAll(opts.rootSel + ' ' + opts.footNotesContainerSel);\n\n  Array.prototype.forEach.call(footNotesConts, function (footNoteCont) {\n    footNoteCont.parentNode.removeChild(footNoteCont);\n  });\n\n  return sidenotes;\n};\n\n\nvar initializeFootnotes = function initializeFootnotes(options) {\n  'use strict';\n  var opts = options || {\n    rootSel: '#main',\n    footNotesContainerSel: '.footnotes',\n    footNoteIdPattern: 'fn:',\n    footNoteAnchorIdStart: 'fnref',\n    sideNoteClass: 'sn-note'\n  };\n\n  var renderSideNotes = function renderSideNotes(sidenotes) {\n    //place sidenotes into the DOM, just before their anchor ref.\n    //remove any previously rendered infocards and/or hide original footnotes\n    sidenotes.forEach(function (note) {\n      //get the global container\n      var container = note.ref.parentElement;\n      //in the container, insert the label, input and note before the anchor parent\n      container.insertBefore(note.label, note.ref);\n      container.insertBefore(note.input, note.ref);\n      container.insertBefore(note.node, note.ref);\n      // then delete the anchor\n      container.removeChild(note.ref);\n    });\n  };\n\n  var notes = processFootNotesToSideNotes(opts);\n  //console.dir(notes);\n  renderSideNotes(notes);\n\n};\n","/*jshint esversion: 6 */\n\n\n// Work in progress clickable / dublickable pastilla\nconst wip = document.querySelector('.under');\nif(wip) setRandomPosition(wip);\n\n// set element random position\nfunction setRandomPosition(e){\n  var left = Math.round( Math.random() * (window.innerWidth  - e.getBoundingClientRect().width  ));\n  var tp  = Math.round( Math.random() * (window.innerHeight - e.getBoundingClientRect().height ));\n  e.style.left = left + \"px\";\n  e.style.top = tp + \"px\";\n}\n\n// attach onclick\ndocument.body.onclick = (event) => {\n  if(event.target.classList.contains('under')){\n    var w = event.target.cloneNode(true);\n    w.classList.remove('open');\n    document.body.appendChild(w);\n    setRandomPosition(w);\n    event.target.classList.add('open');\n  }\n};\n\n\n// comments expander\nconst headings = document.querySelectorAll('.expander');\n\nArray.prototype.forEach.call(headings, heading => {\n  let btn = heading.querySelector('button');\n  let target = heading.nextElementSibling;\n\n  if(document.location.hash == '#contribute'){\n    btn.setAttribute('aria-expanded', true);\n    target.hidden = false;\n  }\n\n  btn.onclick = () => {\n    let expanded = btn.getAttribute('aria-expanded') === 'true' || false;\n    btn.setAttribute('aria-expanded', !expanded);\n    target.hidden = expanded;\n  };\n});\n\n\n\n\n// media link in article text\n\nconst article = document.querySelector('#main');\n\n\nif(article){\n\n\n  initializeFootnotes();\n  \n  article.onclick = (event) => {\n    console.log(\"ici\");\n    const link = event.target;\n    if(link.classList.contains('media-link') ){\n      event.preventDefault();\n\n      if(link.classList.contains('opened')) {\n        var fig = document.querySelector('#figure-'+link.dataset.id);\n        fig.parentElement.removeChild(fig);\n        link.classList.remove(\"opened\");\n        return;\n      }\n\n      // create figure\n      const figure = document.createElement('figure');\n      figure.className = \"media-container\";\n      figure.id = 'figure-'+link.dataset.id;\n\n      if(link.dataset.type == \"image\"){\n        const image = document.createElement('img');\n        image.classname = 'media';\n        figure.appendChild(image);\n        // append on load\n        image.onload = () => {\n          var parent = link.parentNode;\n          parent.parentNode.insertBefore(figure, parent.nextElementSibling);\n          link.classList.add('opened');\n        };\n        // load image\n        const src = link.getAttribute('href');\n        image.src = src;\n        // alt\n        var alt = link.dataset.alt;\n        if (alt){\n          image.setAttribute('alt', alt);\n        }\n      }        \n\n      if(link.dataset.type == \"video\"){\n        const video = document.createElement('video');\n        video.classname = 'media';\n        figure.appendChild(video);\n        // load video\n        const src = link.getAttribute('href');\n        video.src = src;\n        video.setAttribute('controls', 'true');\n        var parent = link.parentNode;\n        parent.parentNode.insertBefore(figure, parent.nextElementSibling);\n        link.classList.add('opened');\n        // alt\n        var alt = link.dataset.alt;\n        if (alt){\n          video.setAttribute('alt', alt);\n        }\n      }        \n\n      // caption\n      var caption = link.nextElementSibling;\n      var source = link.dataset.source;\n      if (caption || source){\n        const figcaption = document.createElement('figcaption');\n        if(caption.matches('.media-caption')){\n          figcaption.innerHTML = '<p>' + caption.innerHTML + '</p>';\n          figure.appendChild(figcaption);\n        }\n        if(source){\n          figcaption.innerHTML = figcaption.innerHTML + '<a href=\"' + source + '\">source</a>';\n        }\n      }\n      \n      // buttons\n      var close = document.createElement('button');\n      close.textContent = \"×\";\n      close.className= \"close\";\n      figure.appendChild(close);\n      close.onclick = () => {\n        figure.parentNode.removeChild(figure);\n        link.classList.remove('opened');\n      };\n    }\n  };\n}\n\n\n\n\n\n// a little dust under the carpet\n\n// media link in article text\n\n// const article = document.querySelector('#main');\n// var thatlink = null, thatfigure = null, thatdirection = null;\n\n// var lightbox_html = \"<figure class='media-container'></figure>\"\n// if(article){\n//   article.onclick = (event) => {\n//     const link = event.target;\n//     if(link.classList.contains('media-link') ){\n//       event.preventDefault();\n//       if(link.classList.contains('opened')) return false;\n//       // create figure\n//       const figure = document.createElement('figure');\n//       figure.className = \"media-container\";\n\n//       if(link.dataset.type == \"image\"){\n//         const image = document.createElement('img');\n//         image.classname = 'media';\n//         figure.appendChild(image);\n//         image.onload = () => {\n//           article.appendChild(figure);\n//           setRandomPosition(figure);\n//           thatlink = link;\n//           thatfigure = figure;\n//           link.classList.add('opened');\n//           thatdirection = Math.random() > .5 ? 'left' : 'right';\n//           drawConnector();\n//         }\n//         const src = link.getAttribute('href');\n//         image.src = src;\n//       }        \n\n//       // caption\n//       var caption = link.nextElementSibling;\n//       if (caption){\n//         if(caption.matches('.media-caption')){\n//           const figcaption = document.createElement('figcaption');\n//           figcaption.innerHTML = caption.innerHTML;\n//           figure.appendChild(figcaption);\n//         }\n//       }\n\n//       // buttons\n//       var close = document.createElement('button');\n//       close.textContent = \"×\";\n//       figure.appendChild(close);\n//       var expand = document.createElement('button');\n//       expand.textContent = \"⤢\";\n//       figure.appendChild(expand);\n      \n\n//       // drag\n\n//     }\n    \n//     // if(link.closest('figure') !== null){\n//     //   if(link.closest('figure').classList.contains('media-container')){\n\n//     //     const arrowLeft  = document.querySelector(\"#arrowLeft\");\n//     //     const arrowRight = document.querySelector(\"#arrowRight\");\n//     //     arrowLeft.removeAttribute('d');\n//     //     arrowRight.removeAttribute('d');\n//     //     thatlink.classList.remove('opened');\n//     //     thatfigure.parentNode.removeChild(thatfigure);\n//     //     thatlink = null; \n//     //     thatfigure = null; \n//     //     thatdirection = null;\n//     //   }\n//     // }\n//   };\n//   window.onscroll = () => {\n//     drawConnector();\n//   }\n// }\n\n\n\n\n// function drawConnector() {\n//   if(thatlink === null || thatfigure === null || thatdirection === null) {\n//     return false;\n//   }\n  \n\n//   const arrowLeft  = document.querySelector(\"#arrowLeft\");\n//   const arrowRight = document.querySelector(\"#arrowRight\");\n//   var posnALeft = {\n//     x: thatlink.offsetLeft - 8,\n//     y: thatlink.offsetTop - document.documentElement.scrollTop  + thatlink.offsetHeight / 2\n//   };\n//   var posnARight = {\n//     x: thatlink.offsetLeft + thatlink.offsetWidth + 8,\n//     y: thatlink.offsetTop - document.documentElement.scrollTop  + thatlink.offsetHeight / 2    \n//   };\n//   var posnBLeft = {\n//     x: thatfigure.offsetLeft - 8,\n//     y: thatfigure.offsetTop  - document.documentElement.scrollTop  + thatfigure.offsetHeight / 2\n//   };\n//   var posnBRight = {\n//     x: thatfigure.offsetLeft + thatfigure.offsetWidth + 8,\n//     y: thatfigure.offsetTop  - document.documentElement.scrollTop  + thatfigure.offsetHeight / 2\n//   };\n//   var bend = 100 + Math.abs(posnBRight.x - posnARight.x) / 3;\n//   var dStrLeft =\n//       \"M\" +\n//       (posnALeft.x        ) + \",\" + (posnALeft.y) + \" \" +\n//       \"C\" +\n//       (posnALeft.x - bend ) + \",\" + (posnALeft.y) + \" \" +\n//       (posnBLeft.x - bend ) + \",\" + (posnBLeft.y) + \" \" +\n//       (posnBLeft.x        ) + \",\" + (posnBLeft.y);\n//   var dStrRight = \n//       \"M\" +\n//       (posnARight.x       ) + \",\" + (posnARight.y) + \" \" +\n//       \"C\" +\n//       (posnARight.x + bend) + \",\" + (posnARight.y) + \" \" +\n//       (posnBRight.x + bend) + \",\" + (posnBRight.y) + \" \" +\n//       (posnBRight.x       ) + \",\" + (posnBRight.y);\n\n//   if(thatdirection == 'left') {\n//     arrowLeft.setAttribute(\"d\", dStrLeft);\n//   } else {\n//     arrowRight.setAttribute(\"d\", dStrRight);\n//   }\n// };\n\n\n\n// var drg = {\n//   element: null,\n//   active: false,\n//   currentX: null,\n//   currentY: null,\n//   initialX: 0,\n//   initialY: 0,\n//   xOffset: 0,\n//   yOffset: 0,\n//   setTranslate: function(xPos, yPos, el) {\n//     el.style.transform = \"translate3d(\" + xPos + \"px, \" + yPos + \"px, 0)\";\n//     drawConnector();\n//   },\n//   dragStart: function(e){\n//     if (e.type === \"touchstart\") {\n//       drg.initialX = e.touches[0].clientX - drg.xOffset;\n//       drg.initialY = e.touches[0].clientY - drg.yOffset;\n//     } else {\n//       drg.initialX = e.clientX - drg.xOffset;\n//       drg.initialY = e.clientY - drg.yOffset;\n//     }\n//     if (e.target.matches('.media-container')) {\n//       drg.element = e.target;\n//       drg.active = true;\n//     }\n//   },\n//   dragEnd: function(){    \n//       drg.initialX = drg.currentX;\n//       drg.initialY = drg.currentY;\n//       drg.active = false;    \n//   },\n//   drag: function(e){\n//     if (drg.active) {\n//       e.preventDefault();  \n//       if (e.type === \"touchmove\") {\n//         drg.currentX = e.touches[0].clientX - drg.initialX;\n//         drg.currentY = e.touches[0].clientY - drg.initialY;\n//       } else {\n//         drg.currentX = e.clientX - drg.initialX;\n//         drg.currentY = e.clientY - drg.initialY;\n//       }\n//       drg.xOffset = drg.currentX;\n//       drg.yOffset = drg.currentY;\n//       drg.setTranslate(drg.currentX, drg.currentY, drg.element);\n//     }\n//   }\n// }\n\n\n// article.addEventListener(\"touchstart\", drg.dragStart, false);\n// article.addEventListener(\"touchend\", drg.dragEnd, false);\n// article.addEventListener(\"touchmove\", drg.drag, false);\n// article.addEventListener(\"mousedown\", drg.dragStart, false);\n// article.addEventListener(\"mouseup\", drg.dragEnd, false);\n// article.addEventListener(\"mousemove\", drg.drag, false);\n\n\n"]}